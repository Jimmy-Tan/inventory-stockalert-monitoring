@model Project.Models.Transaction

@{
    ViewData["Title"] = "Kirim Barang ke Toko";
}

<div class="container mt-4">
    <div class="card shadow">
        <div class="card-header bg-dark text-white">
            <h4 class="mb-0">🚚 Kirim Barang ke Toko</h4>
        </div>
        <div class="card-body">
            <form asp-action="CreateBarangKeluarToStore" method="post">
                <div asp-validation-summary="ModelOnly" class="text-danger mb-3"></div>

                <div class="mb-3">
                    <label asp-for="StoreId" class="form-label">🏬 Toko Tujuan</label>
                    <select asp-for="StoreId" asp-items="ViewBag.StoreId" class="form-select"></select>
                </div>

                <div class="mb-3">
                    <label asp-for="SupplierId" class="form-label">🚚 Supplier Asal</label>
                    <select asp-for="SupplierId" asp-items="ViewBag.SupplierId" class="form-select" id="supplierDropdown"></select>
                </div>

                <div class="mb-3">
                    <label asp-for="ProductId" class="form-label">📦 Produk</label>
                    <select asp-for="ProductId" class="form-select" id="productDropdown">
                        <option value="">-- Pilih produk --</option>
                    </select>
                </div>

                <div class="mb-3">
                    <label asp-for="QtyOut" class="form-label">🔢 Qty Keluar</label>
                    <input asp-for="QtyOut" type="number" class="form-control" min="1" />
                </div>

                <div class="d-flex justify-content-between">
                    <a asp-action="Index" class="btn btn-secondary">← Kembali</a>
                    <button type="submit" class="btn btn-success">🚀 Kirim ke Toko</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script>
        $(document).ready(function () {
            $('#supplierDropdown').change(function () {
                var supplierId = $(this).val();
                var productDropdown = $('#productDropdown');

                productDropdown.empty();
                productDropdown.append('<option value="">Memuat produk...</option>');

                if (supplierId) {
                    $.getJSON('/Transactions/GetProductsBySupplier', { supplierId: supplierId })
                        .done(function (data) {
                            productDropdown.empty();
                            productDropdown.append('<option value="">-- Pilih produk --</option>');
                            $.each(data, function (index, item) {
                                productDropdown.append('<option value="' + item.id + '">' + item.name + '</option>');
                            });
                        })
                        .fail(function () {
                            productDropdown.empty();
                            productDropdown.append('<option value="">❌ Gagal memuat produk</option>');
                        });
                } else {
                    productDropdown.empty();
                    productDropdown.append('<option value="">-- Pilih produk --</option>');
                }
            });
        });
    </script>
}
